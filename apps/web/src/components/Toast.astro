---
/**
 * Global Toast component for notifications.
 */
---

<div id="toast-container" class="toast-container"></div>

<script>
  import { $toasts } from '../store/toastStore.js';

  const container = document.getElementById('toast-container');

  $toasts.subscribe(toasts => {
    if (!container) return;
    
    // Efficiently sync DOM with state
    const currentIds = Array.from(container.children).map(child => (child as HTMLElement).dataset.id);
    const stateIds = toasts.map(t => t.id);

    // Remove old toasts
    currentIds.forEach(id => {
      if (!stateIds.includes(id)) {
        const el = container.querySelector(`[data-id="${id}"]`);
        el?.classList.add('removing');
        setTimeout(() => el?.remove(), 300);
      }
    });

    // Add new toasts
    toasts.forEach(toast => {
      if (!currentIds.includes(toast.id)) {
        const el = document.createElement('div');
        el.className = `toast toast-${toast.type}`;
        el.dataset.id = toast.id;
        el.innerHTML = `
          <div class="toast-content">
            <span class="toast-icon">
              ${toast.type === 'success' ? '✓' : toast.type === 'error' ? '✕' : 'ℹ'}
            </span>
            <span class="toast-message">${toast.message}</span>
          </div>
        `;
        container.appendChild(el);
      }
    });
  });
</script>

<style>
  .toast-container {
    position: fixed;
    top: 32px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 9999;
    display: flex;
    flex-direction: column;
    gap: 12px;
    pointer-events: none;
  }

  .toast {
    min-width: 300px;
    background: #282828;
    color: white;
    padding: 12px 20px;
    border-radius: 8px;
    box-shadow: 0 8px 16px rgba(0,0,0,0.5);
    border: 1px solid rgba(255,255,255,0.1);
    display: flex;
    align-items: center;
    animation: slideIn 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28);
    pointer-events: auto;
  }

  .toast.removing {
    animation: slideOut 0.3s forwards;
  }

  .toast-content {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .toast-icon {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: bold;
  }

  .toast-success .toast-icon {
    background: #1db954;
    color: black;
  }

  .toast-error .toast-icon {
    background: #e91429;
    color: white;
  }

  .toast-info .toast-icon {
    background: #2e77d0;
    color: white;
  }

  .toast-message {
    font-size: 0.875rem;
    font-weight: 500;
  }

  @keyframes slideIn {
    from {
      opacity: 0;
      transform: translateY(-20px) scale(0.9);
    }
    to {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }

  @keyframes slideOut {
    from {
      opacity: 1;
      transform: scale(1);
    }
    to {
      opacity: 0;
      transform: scale(0.9);
    }
  }
</style>
